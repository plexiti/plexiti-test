<!doctype html>
<html lang='en'>
<head>
  <script src='https://plexiti.github.io/plexiti-test/en/js/lang.js'></script>
  <link href='//fonts.googleapis.com/css?family=Open+Sans:400,300,400italic,600,600italic,700,700italic,300italic' rel='stylesheet' type='text/css'>
  <meta charset='utf-8'>
  
      
      <title>Understanding Process &#34;Waitstate Mocking&#34;</title>
      
  
    <link href='https://plexiti.github.io/plexiti-test/en/blog/index.xml' rel='alternate' type='application/rss+xml' title='plexiti - the business programmer blog' />
  
    <link href='https://plexiti.github.io/plexiti-test/en/blog/index.xml' rel='home' type='application/rss+xml' title='plexiti - the business programmer blog' />
  
  <meta name='apple-mobile-web-app-capable' content='yes'>
  <meta name='viewport' content='width=device-width, initial-scale=1'>
  <link href='https://plexiti.github.io/plexiti-test/en/animate.css' rel='stylesheet' type='text/css'>
  <link rel='stylesheet' href='https://plexiti.github.io/plexiti-test/en/js/woothemes-FlexSlider-06b12f8/flexslider.css' type='text/css' media='screen'>
  <link rel='stylesheet' href='https://plexiti.github.io/plexiti-test/en/js/prettyPhoto_3.1.5/prettyPhoto.css' type='text/css' media='screen'>
  <link href='https://plexiti.github.io/plexiti-test/en/style.css' rel='stylesheet' type='text/css'>

  <link rel='stylesheet' href='https://plexiti.github.io/plexiti-test/en/fonts/bariol/plexiti-bariol.css' media='screen' />
  <link rel='stylesheet' href='https://plexiti.github.io/plexiti-test/en/fonts/font-awesome/css/font-awesome.min.css' media='screen'>
  <script src='//code.jquery.com/jquery-latest.min.js'></script>
  <script type='text/javascript' src='https://plexiti.github.io/plexiti-test/en/js/modernizr.custom.48287.js'></script>
  
  <link rel='shortcut icon' type='image/x-icon' href='https://plexiti.github.io/plexiti-test/en/favicon.ico' />
  <link rel='apple-touch-icon-precomposed' sizes='114x114' href='https://plexiti.github.io/plexiti-test/en/apple-touch-icon-114x114-precomposed.png'>
  <link rel='apple-touch-icon-precomposed' sizes='72x72' href='https://plexiti.github.io/plexiti-test/en/apple-touch-icon-72x72-precomposed.png'>
  <link rel='apple-touch-icon-precomposed' href='https://plexiti.github.io/plexiti-test/en/apple-touch-fa-57x57-precomposed.png'>

  <script type='text/javascript' src='https://plexiti.github.io/plexiti-test/en/js/moment/moment-with-locales.min.js'></script>
  <script type='text/javascript' src='https://plexiti.github.io/plexiti-test/en/js/bpmn-js/bpmn-viewer.min.js'></script>
  <script type='text/javascript' src='https://plexiti.github.io/plexiti-test/en/js/cmmn-js/cmmn-viewer.min.js'></script>
  <script type='text/javascript' src='https://plexiti.github.io/plexiti-test/en/js/dmn-js/dmn-viewer.min.js'></script>
  <script type='text/javascript' src='https://plexiti.github.io/plexiti-test/en/js/plexiti.js'></script>
  <script type='text/javascript' src='https://plexiti.github.io/plexiti-test/en/js/lang.js'></script>

  <link href='https://plexiti.github.io/plexiti-test/en/css/plexiti.css' rel='stylesheet' type='text/css'>
  <link href='https://plexiti.github.io/plexiti-test/en/js/dmn-js/css/dmn-js.css' rel='stylesheet' type='text/css'>
  <link href='https://plexiti.github.io/plexiti-test/en/js/rainbow/rainbow-github.css' rel="stylesheet" type="text/css">

</head>
<body data-spy='scroll' data-target='#TableOfContents' data-offset='50'>
<header>
  <div class='top-bg-color-bar'></div>
  <div class='container'>
    <div class='navbar navbar-default' role='navigation'>
      <div class='navbar-header'>
        <a class='navbar-brand' href='https://plexiti.github.io/plexiti-test/en/'>
          <img src='https://plexiti.github.io/plexiti-test/en/img/logo.png' style='width: 250px; height: 96px' title='plexiti'>
          <span class='logo_subtitle' style='font-size: 13pt;'>the business programmer blog</span>
        </a>
      </div>
      <div class='collapse navbar-collapse'>
        <ul class='nav pull-right navbar-nav'>
          
          
            <li><a href='https://plexiti.github.io/plexiti-test/en/blog/'>Blog</a></li>
          
            <li><a href='https://plexiti.github.io/plexiti-test/en/about/'>About</a></li>
          
        </ul>
      </div>
    </div>
    <div id="social_media_wrapper">
      
        
        
          
          <a href='https://plexiti.github.io/plexiti-test/en/../de/blog/2016/09/understanding-process-waitstate-mocking/' title='Diese Seite ist auf Deutsch abrufbar.'><i class="fa">de</i></a>
          <script>
            redirect2language('https:\/\/plexiti.github.io\/plexiti-test\/en\/');
          </script>
          
          <a href='.' title='This page is available in english.'><i class="fa">en</i></a>
        
      
    </div>
  </div>
</header>

<div class='main' id='post'>
     <section class='hgroup'>
          <div class='container'>
               <h1>Understanding Process &ldquo;Waitstate Mocking&rdquo;</h1>
               <h2>This post works through the details of a small Camunda BPM Assert Scenario example to explain what happens behind a &ldquo;scenario&rdquo;.<span style='float:right'><script>document.write(moment('2016-09-24').locale('en').format('LL'))</script></span></h2>
          </div>
     </section>
     <section>
          <div class='container'>
               <div class='row'>
                    <div id='leftcol' class='col-sm-12 col-md-8' role='main'>
                         <article class='post'>
                              <div class='post_content'>
                                   

<p>While the new Camunda BPM community extension <a href="https://github.com/camunda/camunda-bpm-assert-scenario">&ldquo;Assert Scenario&rdquo;</a> makes it almost effortless to <strong>maintain extensive test suites for large process models</strong>, it&rsquo;s necessary to go through small examples first to grasp the idea and understand what happens behind the scenes of a &ldquo;scenario&rdquo; <i class='fa fa-smile-o' aria-hidden='true'></i>! Today I guide you through the first part of the example I showed at the community day. I pushed all sources I am writing about to <a href="https://github.com/martinschimak/camunda-bpm-scenario-testing">GitHub</a>, again. Just check out the &ldquo;readme-process&rdquo; branch!</p>

<h1 id="a-first-project-to-get-you-started">A First Project to Get You Started</h1>

<p>If you need guidance how to set up a new Camunda BPM project, please check out my last blog post about how to <a href="https://plexiti.github.io/plexiti-test/en/blog/2016/09/get-started-with-camunda-bpm-assert-scenario/">Get Started with Camunda BPM - and Assert Scenario</a>.</p>

<h1 id="the-community-day-process-model">The Community Day Process Model</h1>

<p>The following model shows a user task which needs to be completed - and a second one to remind the colleague in charge of that work on a daily basis. <i class='fa fa-smile-o' aria-hidden='true'></i></p>


<div class='bpmn' bpmn='https://plexiti.github.io/plexiti-test/en/./blog/2016/09/src/CommunityDay2016Process.bpmn'>
</div>

<h1 id="mocking-the-waitstates">Mocking the Waitstates</h1>

<p>When testing with Camunda BPM Assert Scenario, the basic idea is to <strong>mock</strong> all (actionable) <strong>&ldquo;waitstates&rdquo;</strong>: states at which the process has to wait for some actions, which typically come from &ldquo;outside&rdquo; of the process execution. User Tasks are the most obvious example for such waitstates, but there are others, too, like e.g. Receive Tasks, Event Based Gateways, Intermediate Catching Events and so on. Nowadays in particular also all services executed by external worker threads are such waitstates from a process engine perspective. Camunda BPM therefore calls them &lsquo;External Tasks&rsquo;.</p>

<p>Now, how can you mock such actionable waitstates? Camunda BPM Assert Scenario provides you with a <code>ProcessScenario</code> interface to do that. Simply mock that interface with the Mocking Framework of your choice. I am using <a href="http://mockito.org">Mockito</a>:</p>
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%"><span></span><span style="color: #AA22FF; font-weight: bold">public</span> ProcessScenario process <span style="color: #666666">=</span> Mockito<span style="color: #666666">.</span><span style="color: #BB4444">mock</span><span style="color: #666666">(</span>ProcessScenario<span style="color: #666666">.</span><span style="color: #BB4444">class</span><span style="color: #666666">);</span>
</pre></div>

<h1 id="defining-waitstate-actions">Defining Waitstate Actions</h1>

<p>So far we just created an &ldquo;empty&rdquo; Mock Object - in the next step we want to &ldquo;fill&rdquo; it with some &ldquo;behaviour&rdquo;. The behaviour we need are the actions that we need to execute when arriving at waitstates. Therefore the <code>ProcessScenario</code> interface provides methods which allow us to do just that, e.g. a <code>waitsAtUserTask(String activityId)</code> method which returns a void &ldquo;function&rdquo;. It is the action we want to have executed when arriving at a waitstate, in our case the user task with the activity id &ldquo;CompleteWork&rdquo;:</p>
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%"><span></span>Mockito<span style="color: #666666">.</span><span style="color: #BB4444">when</span><span style="color: #666666">(</span>process<span style="color: #666666">.</span><span style="color: #BB4444">waitsAtUserTask</span><span style="color: #666666">(</span><span style="color: #BB4444">&quot;CompleteWork&quot;</span><span style="color: #666666">)).</span><span style="color: #BB4444">thenReturn</span><span style="color: #666666">((</span>task<span style="color: #666666">)</span> <span style="color: #666666">-&gt;</span> <span style="color: #666666">{</span>
  task<span style="color: #666666">.</span><span style="color: #BB4444">complete</span><span style="color: #666666">();</span>
<span style="color: #666666">});</span>
</pre></div>

<p>While the meaning of these lines can be easily grasped by reading them, let&rsquo;s look at these lines from a pure &ldquo;Mockito&rdquo; perspective: these lines tell the <code>ProcessScenario</code> mock object called <code>process</code> that in case its <code>waitsAtUserTask</code> method is called with the String parameter <code>&quot;CompleteWork&quot;</code> it will return a void function. This function itself is accepting a Camunda <code>Task</code> instance as parameter and its body is using that instance by simply completing the provided task.</p>

<h1 id="executing-the-scenario">Executing the scenario</h1>

<p>Why are we doing that? The <code>Scenario</code> &ldquo;execution&rdquo; provided by Camunda BPM Assert Scenario uses the <code>ProcessScenario</code> mock object to inform the process instance execution of how to proceed. When arriving at a waitstate, let&rsquo;s say our user task, it retrieves the needed <code>Action</code> from the mock object by calling its <code>waitsAtUserTask</code> method with the user task&rsquo;s activity id and executes the <code>Action</code> by calling it with the corresponding Camunda <code>Task</code> instance.</p>

<p>Note btw that when implementing the action, we do not need to retrieve the <code>Task</code> instance from the Camunda database, because we get it injected. Cool, right? <i class='fa fa-smile-o' aria-hidden='true'></i></p>

<p>So let&rsquo;s do it: let&rsquo;s create a fresh process instance and run it through to its end by using the predefined waitstate action:</p>
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%"><span></span>Scenario scenario <span style="color: #666666">=</span> Scenario<span style="color: #666666">.</span><span style="color: #BB4444">run</span><span style="color: #666666">(</span>process<span style="color: #666666">).</span><span style="color: #BB4444">startByKey</span><span style="color: #666666">(</span><span style="color: #BB4444">&quot;CommunityDay2016Process&quot;</span><span style="color: #666666">).</span><span style="color: #BB4444">execute</span><span style="color: #666666">();</span>
</pre></div>

<p>This line tells that we intend to <code>run</code> that <code>ProcessScenario process</code> by starting a new process instancy by key and immediately <code>execute()</code> it. The <code>Scenario</code> object provides a fluent API which allows to add much more sophistication to such scenarios, but let&rsquo;s stick to the simplest things first. When opening the <a href="https://github.com/camunda/camunda-bpm-process-test-coverage">Camunda BPM Process Test Coverage</a> HTML we see that our execution did the following:</p>

<figure>
    
    
    
    
    
    
    
    <img src='https://plexiti.github.io/plexiti-test/en/./blog/2016/09/img/understanding-process-waitstate-mocking.png' >
</figure>



<p>Now, while we see that our process reached the end event, we might want to verify such things also in our process test. We can do that by using Mockito again to look into what happened to the <code>ProcessScenario</code> mock object:</p>
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%"><span></span>Mockito<span style="color: #666666">.</span><span style="color: #BB4444">verify</span><span style="color: #666666">(</span>process<span style="color: #666666">).</span><span style="color: #BB4444">hasFinished</span><span style="color: #666666">(</span><span style="color: #BB4444">&quot;WorkFinished&quot;</span><span style="color: #666666">);</span>
</pre></div>

<p>While again the meaning of this line can be easily grasped by reading it, let&rsquo;s look at this line from a pure &ldquo;Mockito&rdquo; perspective: this line verfies that the <code>ProcessScenario</code> mock object&rsquo;s <code>hasFinished</code> method was called with the parameter <code>&quot;WorkFinished&quot;</code> which happens to be the activity id of our process&rsquo; end event. The <code>Scenario</code> &ldquo;execution&rdquo; provided by Camunda BPM Assert Scenario also uses the <code>ProcessScenario</code> mock object whenever the process instance starts and finishes a flow node. You can therefore use the full power of your mocking framework to verify &ldquo;after the fact&rdquo; what happened. If you do not yet fully trust the new &ldquo;Scenario&rdquo; library, you might instead want to use good old <a href="https://github.com/camunda/camunda-bpm-assert">Camunda BPM Assert</a> assertions to assert just the same fact with the following lines:</p>
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%"><span></span>ProcessInstance processInstance <span style="color: #666666">=</span> scenario<span style="color: #666666">.</span><span style="color: #BB4444">instance</span><span style="color: #666666">(</span>process<span style="color: #666666">);</span>
ProcessEngineAssertions<span style="color: #666666">.</span><span style="color: #BB4444">assertThat</span><span style="color: #666666">(</span>processInstance<span style="color: #666666">).</span><span style="color: #BB4444">hasPassed</span><span style="color: #666666">(</span><span style="color: #BB4444">&quot;WorkFinished&quot;</span><span style="color: #666666">);</span>
</pre></div>

<p>Stay &ldquo;tuned&rdquo; - there is much more to be said about why Camunda BPM Assert Scenario matters to me and in my mind should matter to you. Until then: happy first steps with scenario testing! <i class='fa fa-smile-o' aria-hidden='true'></i></p>

                              </div>
                         </article>
                         
                         <div id='disqus'></div>
                         <div id='disqus_thread'></div>
                         <script>
                              var disqus_config = function () {
                                   this.page.url = 'http:\/\/plexiti.com\/en\/blog\/2016\/09\/understanding-process-waitstate-mocking\/';
                                   this.page.identifier = '\/en\/blog\/2016\/09\/understanding-process-waitstate-mocking\/';
                                   this.page.title = 'Understanding Process \x22Waitstate Mocking\x22';
                                   this.language = "en";
                              };
                              (function() {
                                   var d = document, s = d.createElement('script');
                                   s.src = '//plexiti.disqus.com/embed.js';
                                   s.setAttribute('data-timestamp', +new Date());
                                   (d.head || d.body).appendChild(s);
                              })();
                         </script>
                         
                    </div>
                    <div class='col-md-4 hidden-sm hidden-xs'>
                         <div class='bs-docs-sidebar hidden-print affix-top' role='complementary' data-spy='affix' data-offset-top='318' data-offset-bottom='405'>
                              <nav id="TableOfContents">
<ul>
<li><a href="#a-first-project-to-get-you-started">A First Project to Get You Started</a></li>
<li><a href="#the-community-day-process-model">The Community Day Process Model</a></li>
<li><a href="#mocking-the-waitstates">Mocking the Waitstates</a></li>
<li><a href="#defining-waitstate-actions">Defining Waitstate Actions</a></li>
<li><a href="#executing-the-scenario">Executing the scenario</a></li>
</ul>
</nav>
                         </div>
                    </div>
                    <script type='text/javascript'>
                         if($("#TableOfContents").length === 0) {
                              $('.bs-docs-sidebar').each(function(idx, value) {
                                   $(value).append("<nav id='TableOfContents'><ul></ul></nav>");
                              });
                         }
                         $('#TableOfContents ul').each(function() {
                              this.className = "nav";
                         });
                         
                         var numbers = Math.ceil( 860  /  184 );
                         $('#TableOfContents ul').prepend("<li><a href='#post'><i class='fa fa-hand-o-right' aria-hidden='true'></i> Read this post in about <span class='read-the-discussion en'><b>" + numbers + "<i class='pl'></i></b></span>&nbsp;...</a></li>");
                         
                         $('#TableOfContents ul').append("<li class='disqus_link'><a href='#disqus'><i class='fa fa-comments'></i> ... and join the discussion! <span class='disqus-comment-count en' data-disqus-identifier='/en\/blog\/2016\/09\/understanding-process-waitstate-mocking\/'></span></a></li>");
                         
                    </script>
                    <script type='text/javascript'>
                         $('#TableOfContents a').click(function() {
                              var href = $.attr(this, 'href');
                              href = href.replace(/:/g, '\\:');
                              $('html, body').animate({
                                   scrollTop: jQuery(href).offset().top
                              }, 500, function () {
                                   window.location.hash = href;
                              });
                              return false;
                         });
                    </script>
               </div>
          </div>
     </section>
     <footer>
  <section class='twitter_feed_wrapper'>
    <div class='container'>
      <div class='row'>
        <div class='twitter_feed_icon col-sm-1 col-md-1'><a href='https://twitter.com/MartinSchimak/'><i class='fa fa-twitter'></i></a></div>
        <div class='col-sm-11 col-md-11'>
          <blockquote>
            <p>When I call myself a business programmer - it&rsquo;s mostly <a href="https://plexiti.github.io/plexiti-test/en/about">in lack of a better term</a>! I am into coding just as much as into business analysis&hellip; caring mostly about &ldquo;the business&rdquo;, purpose and logic of a vertical team&rsquo;s product. I marry <a href="http://agilemanifesto.org">Agile</a>, <a href="http://dddcommunity.org/learning-ddd/what_is_ddd/">DDD</a>, <a href="http://martinfowler.com/eaaDev/EventNarrative.html">EDA</a>, <a href="https://camunda.org">BPM</a> and <a href="http://www.martinfowler.com/articles/microservices.html">Microservices</a>!</p>
            <cite><a href='https://twitter.com/MartinSchimak/'>@MartinSchimak</a></cite>
          </blockquote>
        </div>
      </div>
    </div>
  </section>
  <section class='copyright'>
    <div class='container'>
        <div class='row'>
            <div class='col-sm-6 col-md-6'></div>
            <div class='text-right col-sm-6 col-md-6'> Copyright &copy; <script>document.write(moment().format('YYYY'))</script> <a href='https://plexiti.github.io/plexiti-test/en/about'>plexiti GmbH</a> - All rights reserved.</div>
        </div>
    </div>
</section>

</footer>

</div>
<script>window.jQuery || document.write('<script src=\'https:\/\/plexiti.github.io\/plexiti-test\/en\/js\/jquery-1.9.0.min.js\'><\/script>')</script>
<script src='https://plexiti.github.io/plexiti-test/en/twitter-bootstrap/js/bootstrap.min.js' type='text/javascript'></script>
<script type='text/javascript' src='https://plexiti.github.io/plexiti-test/en/js/modernizr.custom.48287.js'></script>
<script src='https://plexiti.github.io/plexiti-test/en/js/woothemes-FlexSlider-06b12f8/jquery.flexslider-min.js'></script>
<script src='https://plexiti.github.io/plexiti-test/en/js/prettyPhoto_3.1.5/jquery.prettyPhoto.js' type='text/javascript' charset='utf-8'></script>
<script src='https://plexiti.github.io/plexiti-test/en/js/isotope/jquery.isotope.min.js' type='text/javascript'></script>
<script type='text/javascript' src='https://plexiti.github.io/plexiti-test/en/js/jquery.ui.totop.js'></script>
<script type='text/javascript' src='https://plexiti.github.io/plexiti-test/en/js/easing.js'></script>
<script type='text/javascript' src='https://plexiti.github.io/plexiti-test/en/js/wow.min.js'></script>
<script type='text/javascript' src='https://plexiti.github.io/plexiti-test/en/js/snap.svg-min.js'></script>
<script type='text/javascript' src='https://plexiti.github.io/plexiti-test/en/js/restart_theme.js'></script>
<script type='text/javascript' src='https://plexiti.github.io/plexiti-test/en/js/collapser.js'></script>
<script id='dsq-count-scr' src='//plexiti.disqus.com/count.js' async></script>

<script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
                (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
    ga('create', 'UA-34569279-1', 'auto');
    ga('send', 'pageview');
</script>

<script>
    setCookie('lang', 'en', 365)
</script>
</body>
</html>

