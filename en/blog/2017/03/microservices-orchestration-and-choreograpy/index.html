<!doctype html>
<html lang='en'>
<head>
  <script src='https://plexiti.github.io/plexiti-test/en/js/lang.js'></script>
  <link href='//fonts.googleapis.com/css?family=Open+Sans:400,300,400italic,600,600italic,700,700italic,300italic' rel='stylesheet' type='text/css'>
  <meta charset='utf-8'>
  
      
      <title>Microservices Collaboration Styles</title>
      
  
    <link href='https://plexiti.github.io/plexiti-test/en/blog/index.xml' rel='alternate' type='application/rss+xml' title='plexiti - (de)coding domain knowledge blog' />
  
    <link href='https://plexiti.github.io/plexiti-test/en/blog/index.xml' rel='home' type='application/rss+xml' title='plexiti - (de)coding domain knowledge blog' />
  
  <meta name='apple-mobile-web-app-capable' content='yes'>
  <meta name='viewport' content='width=device-width, initial-scale=1'>
  <link href='https://plexiti.github.io/plexiti-test/en/animate.css' rel='stylesheet' type='text/css'>
  <link rel='stylesheet' href='https://plexiti.github.io/plexiti-test/en/js/woothemes-FlexSlider-06b12f8/flexslider.css' type='text/css' media='screen'>
  <link rel='stylesheet' href='https://plexiti.github.io/plexiti-test/en/js/prettyPhoto_3.1.5/prettyPhoto.css' type='text/css' media='screen'>
  <link href='https://plexiti.github.io/plexiti-test/en/style.css' rel='stylesheet' type='text/css'>

  <link rel='stylesheet' href='https://plexiti.github.io/plexiti-test/en/fonts/lato/plexiti-lato.css' media='screen' />
  <link rel='stylesheet' href='https://plexiti.github.io/plexiti-test/en/fonts/font-awesome/css/font-awesome.min.css' media='screen'>
  <script src='//code.jquery.com/jquery-latest.min.js'></script>
  <script type='text/javascript' src='https://plexiti.github.io/plexiti-test/en/js/modernizr.custom.48287.js'></script>
  
  <link rel='shortcut icon' type='image/x-icon' href='https://plexiti.github.io/plexiti-test/en/favicon.ico' />
  <link rel='apple-touch-icon-precomposed' sizes='114x114' href='https://plexiti.github.io/plexiti-test/en/apple-touch-icon-114x114-precomposed.png'>
  <link rel='apple-touch-icon-precomposed' sizes='72x72' href='https://plexiti.github.io/plexiti-test/en/apple-touch-icon-72x72-precomposed.png'>
  <link rel='apple-touch-icon-precomposed' href='https://plexiti.github.io/plexiti-test/en/apple-touch-fa-57x57-precomposed.png'>

  <script type='text/javascript' src='https://plexiti.github.io/plexiti-test/en/js/moment/moment-with-locales.min.js'></script>
  <script type='text/javascript' src='https://plexiti.github.io/plexiti-test/en/js/bpmn-js/bpmn-viewer.min.js'></script>
  <script type='text/javascript' src='https://plexiti.github.io/plexiti-test/en/js/cmmn-js/cmmn-viewer.min.js'></script>
  <script type='text/javascript' src='https://plexiti.github.io/plexiti-test/en/js/dmn-js/dmn-viewer.min.js'></script>
  <script type='text/javascript' src='https://plexiti.github.io/plexiti-test/en/js/plexiti.js'></script>
  <script type='text/javascript' src='https://plexiti.github.io/plexiti-test/en/js/lang.js'></script>

  <link href='https://plexiti.github.io/plexiti-test/en/css/plexiti.css' rel='stylesheet' type='text/css'>
  <link href='https://plexiti.github.io/plexiti-test/en/js/dmn-js/css/dmn-js.css' rel='stylesheet' type='text/css'>
  <link href='https://plexiti.github.io/plexiti-test/en/js/rainbow/rainbow-github.css' rel="stylesheet" type="text/css">

</head>
<body data-spy='scroll' data-target='#TableOfContents' data-offset='50'>
<header>
  <div class='top-bg-color-bar'></div>
  <div class='container'>
    <div class='navbar navbar-default' role='navigation'>
      <div class='navbar-header'>
        <a class='navbar-brand' href='https://plexiti.github.io/plexiti-test/en/'>
          <img src='https://plexiti.github.io/plexiti-test/en/img/logo.png' style='width: 250px; height: 96px' title='plexiti'>
          <span class='logo_subtitle' style='font-size: 13pt;'>(de)coding domain knowledge</span>
        </a>
      </div>
      <div class='collapse navbar-collapse'>
        <ul class='nav pull-right navbar-nav'>
          
          
            <li><a href='https://plexiti.github.io/plexiti-test/en/blog/'>Blog</a></li>
          
            <li><a href='https://plexiti.github.io/plexiti-test/en/about/'>About</a></li>
          
        </ul>
      </div>
    </div>
    <div id="social_media_wrapper">
      
        
        
          
          <a href='.' title='This page is available in english.'><i class="fa">en</i></a>
        
      
    </div>
  </div>
</header>

<div class='main' id='post'>
     <section class='hgroup'>
          <div class='container'>
               <h1>Microservices Collaboration Styles</h1>
               <h2>When implementing logical flows along business processes, we can follow two styles of architecture: orchestration and choreography.<span style='float:right'><script>document.write(moment('2017-03-21').locale('en').format('LL'))</script></span></h2>
          </div>
     </section>
     <section>
          <div class='container'>
               <div class='row'>
                    <div id='leftcol' class='col-sm-12 col-md-8' role='main'>
                         <article class='post'>
                              <div class='post_content'>
                                   

<p>In his well known book &ldquo;Building Microservices&rdquo;, Sam Newman wrote: &ldquo;As we start to model more and more complex logic, we have to deal with the problem of <strong>managing business processes that stretch across the boundary of individual services</strong>. [&hellip;] When it comes to actually implementing this <em>flow</em>, there are two styles of architecture we could follow. With <strong>orchestration</strong>, we rely on a central brain to guide and drive the process, much like the conductor in an <em>orchestra</em>. With <strong>choreography</strong>, we inform each part of the system of its job, and let it work out the details, like dancers all finding their way and reacting to others around them in a <em>ballet</em>.&rdquo;</p>

<h1 id="1-the-orchestration-style"><strong>(1) The Orchestration Style</strong></h1>

<p>With <strong>orchestration</strong> style, we move the rules governing the interaction among different services into a central, coordinating unit. By issuing requests and coordinating the meaning of the replies for further steps, this unit reminds a bit of the way a conductor interacts with an orchestra. :-)</p>

<figure>
    
    
    
    
    
    
    
    <img src='https://plexiti.github.io/plexiti-test/en/./blog/2017/03/img/microservices-orchestration.png' >
</figure>



<p>Let&rsquo;s work out a simple example. A customer <strong>places an order</strong> in a <em>webshop</em>. An <em>order service</em> coordinates the following process to fulfill the order. It communicates with three other services, dealing with <em>payment</em>, <em>inventory</em> and <em>shipment</em>:</p>

<figure>
    
    
    
    
    
    
    
    <img src='https://plexiti.github.io/plexiti-test/en/./blog/2017/03/img/microservices-orchestration-model.png' >
</figure>



<ol>
<li>A customer <strong>places an order</strong> in a <em>webshop</em>. As a consequence, an <em>order service</em> coordinates the order fulfillment&hellip;</li>
<li>&hellip; and asks the <em>payment service</em> to <strong>collect money</strong>.</li>
<li>When the <strong>money is collected</strong> &hellip;</li>
<li>&hellip; the order service asks the <em>inventory service</em> to <strong>fetch the items</strong>.</li>
<li>When the <strong>items are fetched</strong> &hellip;</li>
<li>&hellip; the order service asks the <em>shipment service</em> to <strong>ship the parcel</strong>.</li>
<li>And finally, when the <strong>parcel is shipped</strong> &hellip;</li>
<li>&hellip; the order service informs that the <strong>order is delivered</strong>.</li>
</ol>

<p>The whole <em>flow logic</em> for this order fulfillment resides in some central brain acting as the flow &ldquo;conductor&rdquo;. In our case this central brain is the order service, but it could also be centralised in an ESB.</p>

<h1 id="2-the-choreography-style"><strong>(2) The Choreography Style</strong></h1>

<p>With <strong>choreography</strong> style, the rules governing the interaction among different services move into the decentral units. The decentral services are interacting to reach the goal of a business process, each part of the system knows the job it is responsible for, and works out the details on its own.</p>

<figure>
    
    
    
    
    
    
    
    <img src='https://plexiti.github.io/plexiti-test/en/./blog/2017/03/img/microservices-orchestration-and-choreograpy.png' >
</figure>



<p>Quite typically, choreography style architectures will work with some <strong>event publication</strong> mechanism. By means of events, individual services can inform other services of what happened inside of them without needing to know anything about those other services. Note that such event publication might e.g. be implemented by means of a relatively dumb <em>event bus/pipe</em> based on some kind of messaging infrastructure, but it might also be realised via several <em>event feeds</em> published by the individual services themselves, e.g. via Atom/REST.</p>

<p>Let&rsquo;s look how the above example could work without any central conductor issuing commands, but just by means of events.</p>

<figure>
    
    
    
    
    
    
    
    <img src='https://plexiti.github.io/plexiti-test/en/./blog/2017/03/img/microservices-choreography-model.png' >
</figure>



<ol>
<li>Again, the customer <strong>places an order</strong> in the <em>webshop</em>, which therefore issues an &ldquo;Order Created&rdquo; event. As a consequence&hellip;</li>
<li>&hellip; the <em>payment service</em> listening to that event starts to <strong>collect money</strong> and issues a &ldquo;Money Collected&rdquo; event.</li>
<li>The <em>inventory service</em> decides to start to <strong>fetch the items</strong> as soon as the money is collected&hellip;</li>
<li>&hellip; and finally the <em>shipping service</em> will of course <strong>ship the parcel</strong>, when the items are fetched.</li>
</ol>

<p>While this will undoubtedly work, it&rsquo;s probably not a best practice example of making use of events. Even though I am a total fan of choreography and event based architectures (like: really), I have intentionally chosen an example which can serve to discuss some of the negative consequences we face when exaggerating such an approach. Let&rsquo;s therefore dig a bit into some of the tradeoffs we make when leaning towards either orchestration or choreography&hellip;</p>

<h1 id="the-community-preference-towards-choreography">The Community Preference Towards Choreography</h1>

<blockquote>
<p>In general, I have found that systems that tend more toward the choreographed approach are more loosely coupled, and are more flexible and amenable to change [&hellip;]. I have found most heavily orchestrated implementations to be extremely brittle, with a higher cost of change.<cite>Sam Newman</cite></p>
</blockquote>

<p>I have no reason whatsoever to doubt that observation. I agree. Events are a great way to decouple services and increase the autonomy and &ldquo;replaceability&rdquo; of (micro-)services. Many things that were traditionally often done with an orchestration oriented mindset could be done more nicely decoupled and cleaner by going (much) more toward the choreographed approach.</p>

<p>The question remains: how far should we go in the direction of choreography? What are the tradeoffs guiding the decision?</p>

<h1 id="pros-and-cons-of-orchestration-and-choreography">Pros and Cons of Orchestration and Choreography</h1>

<p>An argument often cited <strong>pro orchestration</strong> is, that a central conductor can easily track the state of the overall flow. Sam Newman points that out, too: with choreography you might have to do some extra work to monitor and track across system boundaries. However, this is more a question of tooling to be done more appropriate for choreography.</p>

<p>The central argument <strong>pro choreography</strong> is that the central conductor in the orchestration approach can easily become &ldquo;too much&rdquo; of a central authority and a central point where most of the logic starts to live. Sam Newman states that in practice he has seen this approach &ldquo;result in a small number of smart god services telling anemic CRUD-based services what to do&rdquo;. Such tendencies of course work against the very central selling points of microservices. Microservices should be as <strong>autonomous</strong> as possible and enable the teams maintaining them to deliver new business features as autonomous and fast as possible.</p>

<p>Just imagine we add a very simple <em>customer notification service</em> to the example shown above. Such a service could send out emails on demand, e.g. when being asked so by the <em>order service</em> in the orchestration approach. Another, choreographed approach would be to let the customer configure how much information about the order fulfillment s/he wants to have in the inbox via a fully autonomous <em>customer notification service</em>.</p>

<figure>
    
    
    
    
    
    
    
    <img src='https://plexiti.github.io/plexiti-test/en/./blog/2017/03/img/microservices-customer-notification.png' >
</figure>



<p>The <em>customer notification service</em> listens to many different events. Based on the specific customer&rsquo;s notification settings, it will send out an email or a mobile push message informing the customer about the order fulfillment status - or not. Most importantly: such a service can now be created and improved without any interference with the other services.</p>

<h1 id="3-microservices-collaboration-autonomy-needs-both-styles"><strong>(3) Microservices Collaboration</strong>: Autonomy Needs Both Styles</h1>

<p>A less discussed problem that arises when relying too much on &ldquo;events only&rdquo; is again related to coupling: when using events we couple the subscriber of an event to an event type published by somebody else. Sometimes, this can be unfortunate: if it harms the autonomy of the coupled services more than it would be the case by coupling them via a <strong>command</strong>. To clarify, let&rsquo;s first clarify the terms event and command:</p>

<ul>
<li><p>An <strong>Event</strong> communicates a relevant fact of the business domain. The sender informs that something relevant occurred on its side.</p></li>

<li><p>A <strong>Command</strong> communicates that a business domain relevant operation should happen on the recipient’s side.</p></li>
</ul>

<p>In order to judge whether we should couple two services via event or command, we can ask ourselves: which side of the communication is interested and  responsible to decide whether an event should be followed by another action? The responsible side should transform the event into a command. And it turns out, that organisationally the responsibility can very well be on both sides.</p>

<p>[&hellip; some text missing &hellip;]</p>

<figure>
    
    
    
    
    
    
    
    <img src='https://plexiti.github.io/plexiti-test/en/./blog/2017/03/img/microservices-collaboration.png' >
</figure>



<p>The notion of using commands tends a bit more in the direction of orchestration again.</p>

                              </div>
                         </article>
                         
                    </div>
                    <div class='col-md-4 hidden-sm hidden-xs'>
                         <div class='bs-docs-sidebar hidden-print affix-top' role='complementary' data-spy='affix' data-offset-top='318' data-offset-bottom='405'>
                              <nav id="TableOfContents">
<ul>
<li><a href="#1-the-orchestration-style"><strong>(1) The Orchestration Style</strong></a></li>
<li><a href="#2-the-choreography-style"><strong>(2) The Choreography Style</strong></a></li>
<li><a href="#the-community-preference-towards-choreography">The Community Preference Towards Choreography</a></li>
<li><a href="#pros-and-cons-of-orchestration-and-choreography">Pros and Cons of Orchestration and Choreography</a></li>
<li><a href="#3-microservices-collaboration-autonomy-needs-both-styles"><strong>(3) Microservices Collaboration</strong>: Autonomy Needs Both Styles</a></li>
</ul>
</nav>
                         </div>
                    </div>
                    <script type='text/javascript'>
                         if($("#TableOfContents").length === 0) {
                              $('.bs-docs-sidebar').each(function(idx, value) {
                                   $(value).append("<nav id='TableOfContents'><ul></ul></nav>");
                              });
                         }
                         $('#TableOfContents ul').each(function() {
                              this.className = "nav";
                         });
                         
                         var numbers = Math.ceil( 1226  /  184 );
                         $('#TableOfContents ul').prepend("<li><a href='#post'><i class='fa fa-hand-o-right' aria-hidden='true'></i> Read this post in about <span class='read-the-discussion en'><b>" + numbers + "<i class='pl'></i></b></span>&nbsp;...</a></li>");
                         
                    </script>
                    <script type='text/javascript'>
                         $('#TableOfContents a').click(function() {
                              var href = $.attr(this, 'href');
                              href = href.replace(/:/g, '\\:');
                              $('html, body').animate({
                                   scrollTop: jQuery(href).offset().top
                              }, 500, function () {
                                   window.location.hash = href;
                              });
                              return false;
                         });
                    </script>
               </div>
          </div>
     </section>
     <footer>
  <section class='twitter_feed_wrapper'>
    <div class='container'>
      <div class='row'>
        <div class='twitter_feed_icon col-sm-1 col-md-1'><a href='https://twitter.com/MartinSchimak/'><i class='fa fa-twitter'></i></a></div>
        <div class='col-sm-11 col-md-11'>
          <blockquote>
            <p>I&rsquo;m into and onto <a href="http://agilemanifesto.org">Agile</a>, <a href="http://dddcommunity.org/learning-ddd/what_is_ddd/">DDD</a>, <a href="http://martinfowler.com/eaaDev/EventNarrative.html">EDA</a>, <a href="https://camunda.org">BPM</a> and <a href="http://www.martinfowler.com/articles/microservices.html">Microservices</a>! When I&rsquo;m not (de-)coding domain knowledge, I&rsquo;m probably organizing <a href="https://meetup.com/microservices-vienna">Microservices Vienna</a> or <a href="https://meetup.com/camunda-vienna">Camunda Vienna</a>. I&rsquo;m co-editor of <a href="http://www.objektspektrum.de">OBJEKTspektrum</a>.</p>
            <cite><a href='https://twitter.com/MartinSchimak/'>@MartinSchimak</a></cite>
          </blockquote>
        </div>
      </div>
    </div>
  </section>
  <section class='copyright'>
    <div class='container'>
        <div class='row'>
            <div class='col-sm-6 col-md-6'></div>
            <div class='text-right col-sm-6 col-md-6'> Copyright &copy; <script>document.write(moment().format('YYYY'))</script> <a href='https://plexiti.github.io/plexiti-test/en/about'>plexiti GmbH</a> - All rights reserved.</div>
        </div>
    </div>
</section>

</footer>

</div>
<script>window.jQuery || document.write('<script src=\'https:\/\/plexiti.github.io\/plexiti-test\/en\/js\/jquery-1.9.0.min.js\'><\/script>')</script>
<script src='https://plexiti.github.io/plexiti-test/en/twitter-bootstrap/js/bootstrap.min.js' type='text/javascript'></script>
<script type='text/javascript' src='https://plexiti.github.io/plexiti-test/en/js/modernizr.custom.48287.js'></script>
<script src='https://plexiti.github.io/plexiti-test/en/js/woothemes-FlexSlider-06b12f8/jquery.flexslider-min.js'></script>
<script src='https://plexiti.github.io/plexiti-test/en/js/prettyPhoto_3.1.5/jquery.prettyPhoto.js' type='text/javascript' charset='utf-8'></script>
<script src='https://plexiti.github.io/plexiti-test/en/js/isotope/jquery.isotope.min.js' type='text/javascript'></script>
<script type='text/javascript' src='https://plexiti.github.io/plexiti-test/en/js/jquery.ui.totop.js'></script>
<script type='text/javascript' src='https://plexiti.github.io/plexiti-test/en/js/easing.js'></script>
<script type='text/javascript' src='https://plexiti.github.io/plexiti-test/en/js/wow.min.js'></script>
<script type='text/javascript' src='https://plexiti.github.io/plexiti-test/en/js/snap.svg-min.js'></script>
<script type='text/javascript' src='https://plexiti.github.io/plexiti-test/en/js/restart_theme.js'></script>
<script type='text/javascript' src='https://plexiti.github.io/plexiti-test/en/js/collapser.js'></script>
<script id='dsq-count-scr' src='//plexiti.disqus.com/count.js' async></script>

<script>
    setCookie('lang', 'en', 365)
</script>
</body>
</html>

